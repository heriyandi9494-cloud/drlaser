<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Penggunaan Dr Laser</title>
<style>
:root{--neon:#ff3b3b;--bg:#000}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:#fff;font-family:Inter,Segoe UI,system-ui,Arial,sans-serif}
.wrap{max-width:980px;margin:18px auto;padding:18px}
h1{text-align:center;color:var(--neon);text-shadow:0 0 10px var(--neon);margin:6px 0}
.card{background:#060606;border-radius:10px;padding:14px;box-shadow:0 0 20px rgba(255,59,59,0.06);margin-bottom:14px;border:1px solid rgba(255,59,59,0.12)}
label{display:block;font-size:13px;margin-bottom:6px}
input,select,button{width:100%;padding:9px;border-radius:8px;background:transparent;border:1px solid rgba(255,59,59,0.22);color:#fff}
.row{display:flex;gap:10px}
.row > *{flex:1}
.actions{display:flex;gap:10px}
button.primary{background:var(--neon);border:none;cursor:pointer;font-weight:600;box-shadow:0 0 12px rgba(255,59,59,0.25)}
button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);cursor:pointer}
button.primary:hover{box-shadow:0 0 20px var(--neon)}
table{width:100%;border-collapse:collapse;margin-top:10px;margin-bottom:20px}
th,td{padding:10px;border-bottom:1px solid rgba(255,59,59,0.06);text-align:left;font-size:14px}
th{color:var(--neon)}
.muted{opacity:0.7;font-size:13px}
.flex-between{display:flex;justify-content:space-between;align-items:center}
.small{font-size:13px}
.green{color:#00ff7f;font-weight:600}
.blue{color:#1e90ff;font-weight:600}
.yellow{color:#ffd700;font-weight:600}
.red{color:#ff3b3b;font-weight:600}
.hidden{display:none}
.bar-title{margin-top:20px;margin-bottom:6px;font-weight:600;color:var(--neon)}
@media (max-width:720px){.row{flex-direction:column}}
</style>
</head>
<body>
<div class="wrap">
  <h1>ğ‰ğ€ğƒğ–ğ€ğ‹ ğğ„ğğ†ğ†ğ”ğğ€ğ€ğ ğƒğ‘.ğ‹ğ€ğ’ğ„ğ‘</h1>

  <!-- LOGIN -->
  <div class="card" id="loginCard">
    <div class="flex-between">
      <div>
        <div id="authStatus" class="small muted">Belum login</div>
        <div id="userEmail" class="small"></div>
      </div>
      <div style="width:220px">
        <input id="email" type="email" placeholder="Email" />
        <input id="password" type="password" placeholder="Password" style="margin-top:8px" />
        <div class="actions" style="margin-top:8px">
          <button class="primary" id="btnLogin">Login</button>
          <button class="ghost" id="btnSignup">Daftar</button>
        </div>
        <button id="btnLogout" class="ghost hidden" style="margin-top:8px">Logout</button>
      </div>
    </div>
  </div>

  <!-- FORM INPUT & TABLES -->
  <div id="mainContent" class="hidden">
    <!-- FORM INPUT -->
    <div class="card">
      <div class="flex-between">
        <div>
          <label for="tanggal">ğ“ğšğ§ğ ğ ğšğ¥</label>
          <input id="tanggal" type="date" />
        </div>
        <div>
          <label for="penggunaan">ğğğ§ğ ğ ğ®ğ§ğšğšğ§</label>
          <select id="penggunaan">
            <option value="Pagi">ğğšğ ğ¢</option>
            <option value="Malam">ğŒğšğ¥ğšğ¦</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <div>
          <label for="ket">ğŠğğ­ğğ«ğšğ§ğ ğšğ§</label>
          <select id="ket">
            <option>ğƒğ¢ğ©ğšğ¤ğšğ¢</option>
            <option>ğ‘ğğ¬ğ­ğğšğ²</option>
          </select>
        </div>
        <div>
          <label for="bar">ğğšğ«</label>
          <select id="bar">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
          </select>
        </div>
        <div>
          <label for="durasi">ğƒğ®ğ«ğšğ¬ğ¢</label>
          <select id="durasi">
            <option>15 menit</option>
            <option>30 menit</option>
            <option>45 menit</option>
            <option>60 menit</option>
          </select>
        </div>
      </div>

      <div style="margin-top:10px;display:flex;gap:10px">
        <button id="btnAdd" class="primary">ğ’ğ¢ğ¦ğ©ğšğ§</button>
        <button id="btnClear" class="ghost">ğ‘ğğ¬ğğ­</button>
      </div>
      <div id="msg" class="small muted" style="margin-top:8px"></div>
    </div>

    <!-- CONTAINER TABEL MULTI BAR -->
    <div id="tablesContainer"></div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBZSKHhNIAgWGHOjxEh6C2QtEHjS3B6-KQ",
  authDomain: "jadwal-dr-laser.firebaseapp.com",
  projectId: "jadwal-dr-laser",
  storageBucket: "jadwal-dr-laser.firebasestorage.app",
  messagingSenderId: "100398476032",
  appId: "1:100398476032:web:801916082a1572f281e1e5",
  measurementId: "G-EXV0TMTF3Q"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

// UI refs
const loginCard = document.getElementById('loginCard');
const mainContent = document.getElementById('mainContent');
const emailEl = document.getElementById('email');
const passEl = document.getElementById('password');
const btnLogin = document.getElementById('btnLogin');
const btnSignup = document.getElementById('btnSignup');
const btnLogout = document.getElementById('btnLogout');
const authStatus = document.getElementById('authStatus');
const userEmail = document.getElementById('userEmail');
const btnAdd = document.getElementById('btnAdd');
const btnClear = document.getElementById('btnClear');
const msg = document.getElementById('msg');
const tanggalEl = document.getElementById('tanggal');
const penggunaanEl = document.getElementById('penggunaan');
const ketEl = document.getElementById('ket');
const barEl = document.getElementById('bar');
const durasiEl = document.getElementById('durasi');
const tablesContainer = document.getElementById('tablesContainer');

// Set tanggal hari ini
function setToday(){ tanggalEl.value = new Date().toISOString().slice(0,10); }
setToday();

// LOGIN / SIGNUP / LOGOUT
btnLogin.addEventListener('click', ()=>{
  const e=emailEl.value.trim(), p=passEl.value;
  if(!e || !p){ alert('Masukkan email & password'); return; }
  auth.signInWithEmailAndPassword(e,p)
      .catch(err=>alert(err.message));
});
btnSignup.addEventListener('click', ()=>{
  const e=emailEl.value.trim(), p=passEl.value;
  if(!e || !p){ alert('Masukkan email & password'); return; }
  auth.createUserWithEmailAndPassword(e,p)
      .then(()=>alert("Akun dibuat, silakan login"))
      .catch(err=>alert(err.message));
});
btnLogout.addEventListener('click', ()=>auth.signOut());

// AUTH STATE
auth.onAuthStateChanged(u=>{
  if(u){
    authStatus.textContent = "Login sebagai:";
    userEmail.textContent = u.email;
    loginCard.classList.add('hidden');
    mainContent.classList.remove('hidden');
  } else {
    authStatus.textContent = "Belum login";
    userEmail.textContent = "";
    loginCard.classList.remove('hidden');
    mainContent.classList.add('hidden');
  }
});

// SIMPAN DATA
btnAdd.addEventListener('click', async ()=>{
  const tanggal = tanggalEl.value;
  if(!tanggal){ alert("Pilih tanggal"); return; }
  const data = {
    hari: new Date(tanggal).toLocaleDateString("id-ID",{weekday:"long"}),
    tanggal,
    penggunaan: penggunaanEl.value,
    ket: ketEl.value,
    bar: barEl.value,
    durasi: durasiEl.value,
    ts: Date.now()
  };
  try{
    const newRef = db.ref("laser").push();
    await newRef.set(data);
    msg.textContent="Tersimpan âœ“";
    setTimeout(()=>msg.textContent="",2000);
  }catch(e){ alert("Gagal: "+e.message); }
});

// RESET FORM
btnClear.addEventListener('click', ()=>{
  setToday();
  penggunaanEl.value="Pagi";
  ketEl.value="Dipakai";
  barEl.value="1";
  durasiEl.value="15 menit";
  msg.textContent="Form dibersihkan";
  setTimeout(()=>msg.textContent="",1200);
});

// RENDER TABEL MULTI BAR
function renderTables(snapshot){
  tablesContainer.innerHTML="";
  const bars = ["1","2","3","4"];
  bars.forEach(bar=>{
    const barData = [];
    snapshot.forEach(c=>{
      const r = c.val();
      if(r.bar === bar) barData.push({key:c.key,val:r});
    });
    barData.sort((a,b)=>a.val.tanggal > b.val.tanggal ? 1:-1);

    // Buat tabel hanya jika ada data
    const card = document.createElement("div");
    card.className="card";
    const title = document.createElement("div");
    title.className="bar-title";
    title.textContent = "Bar "+bar;
    card.appendChild(title);

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    thead.innerHTML=`<tr><th>No</th><th>Hari</th><th>Tanggal</th><th>Penggunaan</th><th>Keterangan</th><th>Durasi</th><th>Aksi</th></tr>`;
    table.appendChild(thead);
    const tbody = document.createElement("tbody");

    if(barData.length===0){
      tbody.innerHTML=`<tr><td colspan="7" class="muted">Belum ada data</td></tr>`;
    } else {
      barData.forEach((item,i)=>{
        const r=item.val;
        const tr = document.createElement("tr");
        let penggunaanClass = r.penggunaan === "Pagi" ? "green" : "blue";
        tr.innerHTML=`
          <td>${i+1}</td>
          <td>${r.hari}</td>
          <td>${r.tanggal}</td>
          <td class="${penggunaanClass}">${r.penggunaan}</td>
          <td>${r.ket}</td>
          <td class="yellow">${r.durasi}</td>
          <td><button class="ghost" data-key="${item.key}">Hapus</button></td>
        `;
        tbody.appendChild(tr);
      });
    }
    table.appendChild(tbody);
    card.appendChild(table);
    tablesContainer.appendChild(card);

    // Listener hapus
    tbody.querySelectorAll("button").forEach(btn=>{
      btn.addEventListener("click", async ()=>{
        if(confirm("Hapus data?")){
          await db.ref("laser/"+btn.dataset.key).remove();
        }
      });
    });
  });
}

// LISTENER REALTIME
db.ref("laser").on("value", snap=>{ renderTables(snap); });
</script>
</body>
</html>
